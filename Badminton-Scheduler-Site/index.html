<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç¾½çƒé›™æ‰“åˆ†çµ„ç³»çµ±ï¼ˆå¤šäººåŒæ­¥ç‰ˆï¼‰</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #f0f2f7;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 700;
      color: #1a73e8;
      letter-spacing: 1px;
    }

    .card {
      background: #fff;
      padding: 20px;
      border-radius: 18px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      margin-bottom: 24px;
      transition: 0.3s;
    }

    .card:hover {
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    }

    .button {
      padding: 10px 16px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      background: #1a73e8;
      color: white;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 6px;
      transition: 0.2s;
    }

    .button:hover {
      background: #155ec2;
      transform: translateY(-2px);
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 12px;
      outline: none;
      border: 1px solid #ccc;
      margin-bottom: 12px;
      transition: 0.2s;
      background: #fafafa;
    }

    input:focus, textarea:focus {
      border-color: #1a73e8;
      background: #fff;
    }

    .team-box {
      padding: 14px;
      background: #e9f0ff;
      border-radius: 14px;
      margin-bottom: 10px;
      border-left: 4px solid #1a73e8;
    }

    .court {
      padding: 14px;
      background: #fff7e6;
      border-radius: 14px;
      margin-bottom: 10px;
      border-left: 4px solid #ffb300;
    }
  </style>
</head>
<body>

<h1>ç¾½çƒé›™æ‰“åˆ†çµ„ï¼ˆå¤šäººå³æ™‚åŒæ­¥ï¼‰</h1>

<div class="card">
  <h2>âœ¨ å»ºç«‹æˆ–åŠ å…¥æˆ¿é–“</h2>
  <input id="roomCodeInput" placeholder="è¼¸å…¥æˆ¿é–“ä»£ç¢¼ æˆ– å»ºç«‹æ–°æˆ¿é–“" />
  <button class="button" onclick="createRoom()">å»ºç«‹æˆ¿é–“</button>
  <button class="button" onclick="joinRoom()">åŠ å…¥æˆ¿é–“</button>
</div>

<div class="card">
  <h2>âš™ï¸ è¨­å®š</h2>
  <label>å ´åœ°æ•¸ï¼š</label>
  <input id="courtCount" type="number" min="1" value="2" />

  <label>é¸æ‰‹æ¸…å–®ï¼ˆæ¯è¡Œä¸€äººï¼‰ï¼š</label>
  <textarea id="playerList" rows="6"></textarea>

  <button class="button" onclick="createTeams()">å…©å…©åˆ†çµ„</button>
  <button class="button" onclick="skipPairing()">è·³éåˆ†çµ„</button>
</div>

<div class="card">
  <h2>ğŸ‘¥ ç›®å‰çµ„åˆ¥</h2>
  <div id="teamDisplay"></div>
</div>

<div class="card">
  <h2>ğŸ¸ å ´ä¸Šæ¯”è³½</h2>
  <div id="courtDisplay"></div>
</div>

<div class="card">
  <h2>ğŸ›ï¸ æ§åˆ¶</h2>
  <button class="button" onclick="nextRound()">æ›ä¸‹ä¸€çµ„</button>
  <button class="button" onclick="shuffleAll()">é‡æŠ½å…¨éƒ¨çµ„åˆ</button>
</div>

<script>
// ---------------------------
// Firebase åˆå§‹åŒ–
// ---------------------------
const firebaseConfig = {
  apiKey: "AIzaSyD21R1yQ2yf2xFRsP63E7odCAH_0o14exw",
  authDomain: "badminton-scheduler-site.firebaseapp.com",
  databaseURL: "https://badminton-scheduler-site-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "badminton-scheduler-site",
  storageBucket: "badminton-scheduler-site.firebasestorage.app",
  messagingSenderId: "520644414832",
  appId: "1:520644414832:web:cd836fb6454ade5d3093b5",
  measurementId: "G-B7SQTFL659"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let roomCode = "";
let players = [];
let teams = [];
let matchQueue = [];
let courtCount = 2;

// ---------------------------
// æˆ¿é–“åŠŸèƒ½
// ---------------------------
function createRoom() {
  roomCode = Math.random().toString(36).substring(2, 7).toUpperCase();
  alert("æˆ¿é–“å»ºç«‹æˆåŠŸï¼ä»£ç¢¼ï¼š" + roomCode);
  db.ref("rooms/" + roomCode).set({});
}

function joinRoom() {
  const code = document.getElementById("roomCodeInput").value.trim().toUpperCase();
  if (!code) return alert("è«‹è¼¸å…¥æˆ¿é–“ä»£ç¢¼ï¼");
  roomCode = code;
  alert("å·²åŠ å…¥æˆ¿é–“ï¼š" + roomCode);

  // æˆ¿é–“åŒæ­¥ç›£è½
  db.ref("rooms/" + roomCode).on("value", snap => {
    const data = snap.val();
    if (!data) return;
    teams = data.teams || [];
    matchQueue = data.queue || [];
    courtCount = data.courts || 2;

    renderTeams();
    renderCourts();
  });
}

// ---------------------------
// åˆ†çµ„ç”¢ç”Ÿ
// ---------------------------
function saveRoomState() {
  if (!roomCode) return;
  db.ref("rooms/" + roomCode).update({
    teams,
    queue: matchQueue,
    courts: courtCount
  });
}

function createTeams() {
  const input = document.getElementById("playerList").value.trim();
  // ä¿®æ­£ï¼šä½¿ç”¨æ­£ç¢ºçš„æ­£è¦è¡¨é”å¼åˆ†è¡Œ
  players = input.split(/\n+/).map(x => x.trim()).filter(x => x);
  courtCount = parseInt(document.getElementById("courtCount").value) || 1;

  players = players.sort(() => Math.random() - 0.5);
  teams = [];

  for (let i = 0; i < players.length; i += 2) {
    teams.push([players[i], players[i + 1] || "(ç©º)"]);
  }

  matchQueue = [...teams];
  renderTeams();
  renderCourts();
  saveRoomState();
}

function skipPairing() {
  const input = document.getElementById("playerList").value.trim();
  // ä¿®æ­£ï¼šä½¿ç”¨æ­£ç¢ºçš„æ­£è¦è¡¨é”å¼åˆ†è¡Œ
  players = input.split(/\n+/).map(x => x.trim()).filter(x => x);

  teams = players.map(p => [p]);
  matchQueue = [...teams];
  renderTeams();
  renderCourts();
  saveRoomState();
}

// ---------------------------
// UI æ¸²æŸ“
// ---------------------------
function renderTeams() {
  const box = document.getElementById("teamDisplay");
  box.innerHTML = "";
  teams.forEach((t,i)=>{
    const div = document.createElement("div");
    div.className = "team-box";
    div.innerText = `çµ„ ${i+1}: ${t.join("ã€")}`;
    box.appendChild(div);
  });
}

function renderCourts() {
  const box = document.getElementById("courtDisplay");
  box.innerHTML = "";

  for (let i=0; i<courtCount; i++) {
    const div = document.createElement("div");
    div.className = "court";

    const team = matchQueue[i] ? matchQueue[i].join("ã€") : "(ç©ºå ´)";

    div.innerHTML = `
      <strong>å ´åœ° ${i+1}</strong>ï¼š${team}<br>
      <button class='button' onclick="recordResult(${i})">ç´€éŒ„å‹è² ä¸¦æ›çµ„</button>
    `;

    box.appendChild(div);
  }
}

function recordResult(i){
  nextRound();
}

// ---------------------------
// æ§åˆ¶åŠŸèƒ½
// ---------------------------
function nextRound(){
  matchQueue.push(matchQueue.shift());
  renderCourts();
  saveRoomState();
}

function shuffleAll() {
  teams = teams.sort(() => Math.random() - 0.5);
  matchQueue = [...teams];
  renderTeams();
  renderCourts();
  saveRoomState();
}
</script>

</body>
</html>
